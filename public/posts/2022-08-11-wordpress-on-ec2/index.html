<!DOCTYPE html>
<html lang="en">
<head>
  
    <title>WordPress on EC2 :: Stuff About Cloud</title>
  
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="WordPress on EC2 I originally had this blog hosted on Azure with a borrowed MSDN subscription credit with the idea that I would eventually get around to document what I had learnt. Unfortunately the MSDN account I was using expired before I realised.
Silver lining is I get to do it all over again, this time in AWS, and im documenting it right away so I dont fall for the same mistake again" />
<meta name="keywords" content="ESXi, VMWare, AWS, Amazon, Docker, Cloud, Blog" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://stuffabout.cloud/posts/2022-08-11-wordpress-on-ec2/" />




<link rel="stylesheet" href="https://stuffabout.cloud/assets/style.css">






<link rel="apple-touch-icon" href="https://stuffabout.cloud/img/apple-touch-icon-192x192.png">

  <link rel="shortcut icon" href="https://stuffabout.cloud/img/favicon/orange.png">



<meta name="twitter:card" content="summary" />

  
    <meta name="twitter:site" content="" />
  
    <meta name="twitter:creator" content="Will Garbutt" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="WordPress on EC2">
<meta property="og:description" content="WordPress on EC2 I originally had this blog hosted on Azure with a borrowed MSDN subscription credit with the idea that I would eventually get around to document what I had learnt. Unfortunately the MSDN account I was using expired before I realised.
Silver lining is I get to do it all over again, this time in AWS, and im documenting it right away so I dont fall for the same mistake again" />
<meta property="og:url" content="https://stuffabout.cloud/posts/2022-08-11-wordpress-on-ec2/" />
<meta property="og:site_name" content="Stuff About Cloud" />

  
    <meta property="og:image" content="https://stuffabout.cloud/img/favicon/orange.png">
  

<meta property="og:image:width" content="2048">
<meta property="og:image:height" content="1024">


  <meta property="article:published_time" content="2022-08-11 00:00:00 &#43;0000 UTC" />












</head>
<body class="orange">


<div class="container center headings--one-size">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Stuff About Cloud
  </div>
</a>

    </div>
    
  </div>
  
</header>


  <div class="content">
    
<div class="post">
  <h1 class="post-title">
    <a href="https://stuffabout.cloud/posts/2022-08-11-wordpress-on-ec2/">WordPress on EC2</a></h1>
  <div class="post-meta">
    
      <span class="post-date">
        2022-08-11
        
      </span>
    
    
      <span class="post-author">:: Will Garbutt</span>
    
    
  </div>

  
  


  

  <div class="post-content"><div>
        <h2 id="wordpress-on-ec2">WordPress on EC2<a href="#wordpress-on-ec2" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>I originally had this blog hosted on Azure with a borrowed MSDN subscription credit with the idea that I would eventually get around to document what I had learnt. Unfortunately the MSDN account I was using expired before I realised.<br>
Silver lining is I get to do it all over again, this time in AWS, and im documenting it right away so I dont fall for the same mistake again</p>
<h2 id="infrastructure">Infrastructure<a href="#infrastructure" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p><img src="/Images/WordPressonEC2/image1.png" alt=""></p>
<p>The networking side of the infrastructure consists of a new VPC with a single AZ Subnet attached. With that I deployed a new Internet Gateway and new route table. I have a security group allowing SSH (Port22) and HTTPS (Port 443)</p>
<p>I deployed a new EC2 instance and attached the networking above, configured Session Manager and attached an existing keypair.<br>
This was deployed via CloudFormation (Github <a href="https://github.com/wgarbutt/stuffaboutcloud/blob/main/template.yaml">here</a>)</p>
<h2 id="installing-wordpress-and-sql-db">Installing WordPress and SQL DB<a href="#installing-wordpress-and-sql-db" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h2>
<p>I am currently going through the AWS Certified Solutions Architect – Associate training course by Adrian Cantrill (Website <a href="https://learn.cantrill.io/">here</a>) and coincidently am up to a video where they do just this process. I have modified Adrian’s supplied script slightly.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># DBName=database name for wordpress</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># DBUser=mariadb user for wordpress</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># DBPassword=password for the mariadb user for wordpress</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># DBRootPassword = root password for mariadb</span>
</span></span></code></pre></div><h3 id="step-1---configure-authentication-variables-which-are-used-below">STEP 1 - Configure Authentication Variables which are used below<a href="#step-1---configure-authentication-variables-which-are-used-below" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>DBName<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;stuffaboutcloudwp&#39;</span>
</span></span><span style="display:flex;"><span>DBUser<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;stuffaboutcloudwp&#39;</span>
</span></span><span style="display:flex;"><span>DBPassword<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;REPLACEME&#39;</span>
</span></span><span style="display:flex;"><span>DBRootPassword<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;REPLACEME&#39;</span>
</span></span></code></pre></div><h3 id="step-2---install-system-software---including-web-and-db">STEP 2 - Install system software - including Web and DB<a href="#step-2---install-system-software---including-web-and-db" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo yum install -y mariadb-server httpd wget
</span></span><span style="display:flex;"><span>sudo amazon-linux-extras install -y lamp-mariadb10.2-php7.2 php7.2
</span></span></code></pre></div><h3 id="step-3---web-and-db-servers-online---and-set-to-startup">STEP 3 - Web and DB Servers Online - and set to startup<a href="#step-3---web-and-db-servers-online---and-set-to-startup" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo systemctl enable httpd
</span></span><span style="display:flex;"><span>sudo systemctl enable mariadb
</span></span><span style="display:flex;"><span>sudo systemctl start httpd
</span></span><span style="display:flex;"><span>sudo systemctl start mariadb
</span></span></code></pre></div><h3 id="step-4---set-mariadb-root-password">STEP 4 - Set Mariadb Root Password<a href="#step-4---set-mariadb-root-password" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mysqladmin -u root password $DBRootPassword
</span></span></code></pre></div><h3 id="step-5---install-wordpress">STEP 5 - Install WordPress<a href="#step-5---install-wordpress" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo wget http://wordpress.org/latest.tar.gz -P /var/www/html
</span></span><span style="display:flex;"><span>cd /var/www/html
</span></span><span style="display:flex;"><span>sudo tar -zxvf latest.tar.gz
</span></span><span style="display:flex;"><span>sudo cp -rvf wordpress/* .
</span></span><span style="display:flex;"><span>sudo rm -R wordpress
</span></span><span style="display:flex;"><span>sudo rm latest.tar.gz
</span></span></code></pre></div><h3 id="step-6---configure-wordpress">STEP 6 - Configure WordPress<a href="#step-6---configure-wordpress" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sudo cp ./wp-config-sample.php ./wp-config.php
</span></span><span style="display:flex;"><span>sudo sed -i <span style="color:#e6db74">&#34;s/&#39;database_name_here&#39;/&#39;</span>$DBName<span style="color:#e6db74">&#39;/g&#34;</span> wp-config.php
</span></span><span style="display:flex;"><span>sudo sed -i <span style="color:#e6db74">&#34;s/&#39;username_here&#39;/&#39;</span>$DBUser<span style="color:#e6db74">&#39;/g&#34;</span> wp-config.php
</span></span><span style="display:flex;"><span>sudo sed -i <span style="color:#e6db74">&#34;s/&#39;password_here&#39;/&#39;</span>$DBPassword<span style="color:#e6db74">&#39;/g&#34;</span> wp-config.php   
</span></span><span style="display:flex;"><span>sudo chown apache:apache * -R
</span></span></code></pre></div><h3 id="step-7-create-wordpress-db">STEP 7 Create WordPress DB<a href="#step-7-create-wordpress-db" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;CREATE DATABASE </span>$DBName<span style="color:#e6db74">;&#34;</span> &amp;gt;&amp;gt; /tmp/db.setup
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;CREATE USER &#39;</span>$DBUser<span style="color:#e6db74">&#39;@&#39;localhost&#39; IDENTIFIED BY &#39;</span>$DBPassword<span style="color:#e6db74">&#39;;&#34;</span> &amp;gt;&amp;gt; /tmp/db.setup
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;GRANT ALL ON </span>$DBName<span style="color:#e6db74">.* TO &#39;</span>$DBUser<span style="color:#e6db74">&#39;@&#39;localhost&#39;;&#34;</span> &amp;gt;&amp;gt; /tmp/db.setup
</span></span><span style="display:flex;"><span>echo <span style="color:#e6db74">&#34;FLUSH PRIVILEGES;&#34;</span> &amp;gt;&amp;gt; /tmp/db.setup
</span></span><span style="display:flex;"><span>mysql -u root --password<span style="color:#f92672">=</span>$DBRootPassword &amp;lt; /tmp/db.setup
</span></span><span style="display:flex;"><span>sudo rm /tmp/db.setup
</span></span></code></pre></div><h3 id="step-8---browse-to-httpyour_instance_public_ipv4_ip">STEP 8 - Browse to http://your_instance_public_ipv4_ip<a href="#step-8---browse-to-httpyour_instance_public_ipv4_ip" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p><!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="configuring-https">Configuring HTTPS<a href="#configuring-https" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>First step was to point my domain at my EC2 instances public IP address, this is important as the tools we use below needs to verify I own my domain name.</p>
<p>Next I followed <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/SSL-on-amazon-linux-2.html">this</a> post made by AWS on how to configure Lets Encrypt on an EC2 instance, near the last section of the post you will see a heading named <strong>Certificate automation: Let’s Encrypt with Certbot on Amazon Linux 2</strong></p>
<p>This will install all the components needed to use the free Lets Encrypt service and setup a Crontab to enable automatic cert renewal. Very cool</p>
<h3 id="updating-php-from-72-to-74">Updating PHP from 7.2 to 7.4<a href="#updating-php-from-72-to-74" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Some where in my deployment steps above I managed to install an older version of PHP. I was warned of this when I first logged on to WordPress, stating I was using an unsecure version of PHP and that I needed to update it as soon as possible.<br>
Another blog to the rescue! I found <a href="https://greggborodaty.com/amazon-linux-2-upgrading-from-php-7-2-to-php-7-4/">this</a> handy blog post that detailed the steps needed to upgrade PHP</p>
<h3 id="restoring-wordpress-from-backup">Restoring WordPress from backup<a href="#restoring-wordpress-from-backup" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Luckily before my Azure Subscription ran dry I had the wisdom to install a plugin named <a href="https://updraftplus.com/">Updraft</a> that has a free option to back up your entire WordPress deployment to cloud storage such as AWS S3. I simply had to redownload the plugin on my new deployment, point it towards my existing S3 bucket and restore!
<img src="/Images/WordPressonEC2/image2.png" alt=""></p>
<h3 id="cost">Cost<a href="#cost" class="hanchor" ariaLabel="Anchor">&#8983;</a> </h3>
<p>Its early days so far but I estimate this will cost me around $10 a month. This is running on a very small t2.micro EC2 which seems to be running things a lot quicker than my Marketplace deployment of WordPress in Azure, which coincidently drew down my monthly credit by $60 a month.</p>

      </div></div>

  
  
<div class="pagination">
    <div class="pagination__title">
        <span class="pagination__title-h">Read other posts</span>
        <hr />
    </div>
    <div class="pagination__buttons">
        
        
        <span class="button next">
            <a href="https://stuffabout.cloud/posts/2022-08-01-docker-compose-media-stack/">
                <span class="button__text">Docker Compose – Media Stack</span>
                <span class="button__icon">→</span>
            </a>
        </span>
        
    </div>
</div>

  

  
  

  
</div>

  </div>

  
    <footer class="footer">
  <div class="footer__inner">
    
      <div class="copyright copyright--user">
        <span>2022</span>
    
        <span>:: Theme made by <a href="https://twitter.com/panr">panr</a></span>
      </div>
  </div>
</footer>

<script src="https://stuffabout.cloud/assets/main.js"></script>
<script src="https://stuffabout.cloud/assets/prism.js"></script>







  
</div>

</body>
</html>
